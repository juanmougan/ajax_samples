<!DOCTYPE html>
<html>
<head>
  <title>Backend</title>
</head>
<body>
  <form id="my_form" action="http://localhost:4567/pedidos/guardar" method="POST">
    Name:<br>
    <input type="text" name="person_name" id="person_name_form"><br>
    Amount:<br>
    <input type="text" name="amount" id="amount_form"><br>
    Discount:<br>
    <input type="text" name="discount" id="discount_form">
    <br>
    <input type="button" value="Submit" id="submit_form"><br>
    <button type="reset" value="Reset">Reset</button>
  </form>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>

  <script type="text/javascript">
    function isInt(value) {
      var er = /^-?[0-9]+$/;
      return er.test(value);
    }

    function isNull(ndefined) {
      return typeof ndefined === 'undefined' || ndefined == null;
    }

    function validateDiscount() {
      var discountStr = $("#discount_form").val();
      var isDiscountInt = isInt(discountStr);
      var isDiscountNotNull = !isNull(discountStr);
      var isDiscountOk = true;
      if (!isDiscountNotNull) {
        isDiscountOk = isDiscountInt;
      };

      return isDiscountOk;
    }

    function validateName() {
      var nameStr = $("#person_name_form").val();
      var nameLength = nameStr.length;
      var nameNull = isNull(nameStr);
      var isNameLessThan100 = nameLength < 100;
      if (nameNull || nameLength == 0) {
        return false;
      };

      return isNameLessThan100;
    }

    function validateForm() {

      var isDiscountOk = validateDiscount();

      var isNameOk = validateName();

      var amountStr = $("#amount_form").val();
      var isAmountNotNull = !isNull(amountStr);
      var amount = parseInt(amountStr);
      var isAmountInt = isInt(amountStr);

      return isDiscountOk && isNameOk && isAmountNotNull && isAmountInt;
      
    }


  </script>

  <script type="text/javascript">
      $('#submit_form').click( function(event){

        if (validateForm()) {

          var formData = $('#my_form').serialize();
          // var jsonData = JSON.stringify($('#my_form'));
          console.log("Data to be posted: " + formData);
          $.ajax({
            url: 'http://localhost:4567/pedidos/guardar',
            type: 'POST',
            dataType: 'json',
            contentType: 'application/json',
            data:  formData
          }).done(function(data) {
            console.log(" - - - - - - - - - - - - -Data saved - - - - - - - - - - - - -" + data);
            console.dir(data);
          });

        } else {
          alert("Validation failed");
        }
        
      });
  </script>
</body>
</html>
